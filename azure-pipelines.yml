trigger:
  branches:
    include:
      - main

jobs:
- job: 'DeployStorageAccounts'
  displayName: 'Deploy Storage Accounts'
  pool:
    vmImage: 'ubuntu-latest'
  steps:
  - task: AzureResourceManagerTemplateDeployment@3
    inputs:
      deploymentScope: 'Resource Group'
      azureResourceManagerConnection: 'azure-pipelines.yml'
      subscriptionId: 'a8108c2b-496c-424d-8347-ecc8afb6384c'
      action: 'Create Or Update Resource Group'
      resourceGroupName: 'IdoTask'
      location: 'easteurope'
      templateLocation: 'Linked artifact'
      csmFile: 'https://github.com/idoziv12/IdoTask/blob/main/storageAccountTemplate.json'
      overrideParameters: '-storageAccountName "storageAccountA" -location "eastus"'

- job: 'DeployServer'
  displayName: 'Deploy Server'
  pool:
    vmImage: 'ubuntu-latest'
  steps:
  - task: AzureResourceManagerTemplateDeployment@3
    inputs:
      deploymentScope: 'Resource Group'
      azureResourceManagerConnection: 'azure-pipelines.yml'
      subscriptionId: 'a8108c2b-496c-424d-8347-ecc8afb6384c'
      action: 'Create Or Update Resource Group'
      resourceGroupName: 'IdoTask'
      location: 'easteurope'
      templateLocation: 'Linked artifact'
      csmFile: 'https://github.com/idoziv12/IdoTask/blob/main/windowsServerTemplate.json'
      overrideParameters: '-serverName "myServer" -location "eastus" -osType "Windows" -vmSize "Standard_DS2_v2" -adminUsername "admin" -adminPassword "$(adminPassword)"'
